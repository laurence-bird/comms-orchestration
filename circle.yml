machine:
  services:
    - docker

dependencies:
  # CircleCI will magically install pip and cache pip dependencies in requirements.txt
  # Cache the resolution-cache and build streams to speed things up
  cache_directories:
    - "~/.sbt"
    - "target/resolution-cache"
    - "project/target/resolution-cache"

test:
  post:
    - sbt docker:publishLocal

deployment:
  uat_and_prd:
    branch: master
    owner: ovotech
    commands:
      - git clone git@github.com:ovotech/comms-ci-scripts
      - comms-ci-scripts/publish_docker_image.sh
      - comms-ci-scripts/deploy_to_ecs.sh -s orchestration UAT aws/container-definition.json
      - comms-ci-scripts/send_librato_deployment_event.sh
      - comms-ci-scripts/comment_on_last_merged_pr.sh

experimental:
  notify:
    branches:
      only:
        - master
